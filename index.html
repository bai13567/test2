<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Quiet Luxe · Oil Canvas</title>
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#050505;font:12px ui-monospace,Menlo,Consolas,monospace}
canvas{position:fixed;inset:0;display:block}
#ui{position:fixed;left:12px;right:12px;top:12px;z-index:9;display:flex;gap:10px;align-items:center;pointer-events:none;padding-top:env(safe-area-inset-top)}
#pill{flex:1;min-width:0;padding:10px 12px;border-radius:14px;border:1px solid #ffffff2a;
background:linear-gradient(90deg,#ffffff10,#ffd6a814,#7ad7ff10);
backdrop-filter:blur(12px);box-shadow:0 0 0 1px #fff1 inset,0 18px 56px #000b;color:#f7f0e7;mix-blend-mode:screen;
text-shadow:0 0 18px #ffd6a833,0 0 22px #ffffff22;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#pill b{color:#fff}
#btn{pointer-events:auto;padding:10px 14px;border-radius:14px;border:1px solid #fff2;background:#0006;color:#fff;
backdrop-filter:blur(12px);box-shadow:0 0 0 1px #fff1 inset}
#btn:active{transform:translateY(1px)}
#err{position:fixed;left:12px;right:12px;bottom:12px;z-index:99;display:none;
background:#2a0000cc;border:1px solid #ff6a6a55;color:#ffd1d1;border-radius:12px;padding:10px 12px;white-space:pre-wrap}
</style>

<canvas id="c"></canvas>

<div id="ui">
  <div id="pill"><b>QUIET LUXE</b> · <span id="s">building…</span></div>
  <button id="btn">切换</button>
</div>
<div id="err"></div>

<script>
(()=>{"use strict";
const C=document.getElementById("c");
const ctx=C.getContext("2d",{alpha:false});
const S=document.getElementById("s"), BTN=document.getElementById("btn"), ERR=document.getElementById("err");
const mobile=matchMedia("(pointer:coarse)").matches||innerWidth<760;
const clamp=(x,a,b)=>x<a?a:x>b?b:x;
const lerp=(a,b,t)=>a+(b-a)*t;
const mix=(A,B,t)=>[lerp(A[0],B[0],t),lerp(A[1],B[1],t),lerp(A[2],B[2],t)];
const smooth=(a,b,x)=>{x=clamp((x-a)/(b-a),0,1);return x*x*(3-2*x);};
const rgb=(c)=>`rgb(${c[0]|0},${c[1]|0},${c[2]|0})`;
function showErr(e){ERR.style.display="block";ERR.textContent=String(e&&(e.stack||e.message)||e);}

try{
// ---------- size ----------
let W=0,H=0,DPR=1;
function resize(){
  DPR=clamp(devicePixelRatio||1,1,2);
  W=innerWidth; H=innerHeight;
  C.width=Math.max(2,(W*DPR)|0);
  C.height=Math.max(2,(H*DPR)|0);
  C.style.width=W+"px"; C.style.height=H+"px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
  rebuildSoon();
}
addEventListener("resize",resize,{passive:true});

// ---------- RNG ----------
function makeRng(seed){let s=seed>>>0;return ()=>((s=(s*1664525+1013904223)>>>0)&0xfffffff)/0xfffffff;}
let seedBase=123456789;
function nextSeed(){seedBase=(seedBase*1664525+1013904223)>>>0;return seedBase;}

// ---------- palettes (warm, luxe, no purple) ----------
const PALS=[
  // cream / camel / cognac / charcoal
  [[250,244,235],[232,210,175],[188,130,82],[26,22,18]],
  // ivory / sand / bronze / ink
  [[252,246,238],[230,206,170],[170,120,75],[18,18,20]],
  // pearl / beige / umber / espresso
  [[248,242,234],[225,204,174],[155,108,72],[20,16,14]],
  // warm stone / oat / amber / deep brown
  [[246,240,232],[222,202,170],[190,132,78],[24,18,14]],
  // milky / wheat / honey / near-black
  [[251,245,238],[233,214,184],[200,145,85],[16,14,13]],
];

// ---------- offscreen textures ----------
let tex=null, tctx=null, texW=0, texH=0;
let grain=null, gctx=null, grainPat=null;
let scene=null, building=false, rebuildTimer=null;

// create offscreen
function makeCanvas(w,h,alpha=false){
  const c=document.createElement("canvas");
  c.width=w; c.height=h;
  return [c, c.getContext("2d",{alpha, willReadFrequently:false})];
}

function buildGrain(seed){
  const N=256;
  if(!grain){ [grain,gctx]=makeCanvas(N,N,true); }
  grain.width=grain.height=N;
  const im=gctx.createImageData(N,N), d=im.data;
  let s=seed>>>0;
  const rnd=()=>((s=(s*1664525+1013904223)>>>0)&0xfffffff)/0xfffffff;
  for(let i=0;i<d.length;i+=4){
    const r=rnd();
    const v=(r<0.5? r*r : 1-(1-r)*(1-r));
    const n=v-0.5;
    const a=clamp(8 + Math.abs(n)*26, 6, 34);
    d[i]=255; d[i+1]=255; d[i+2]=255; d[i+3]=a;
  }
  gctx.putImageData(im,0,0);
  grainPat=null;
}

// canvas weave (subtle)
function drawWeave(k){
  const s=Math.min(texW,texH);
  tctx.save();
  tctx.globalAlpha=0.085;
  tctx.globalCompositeOperation="overlay";
  for(let i=0;i<3;i++){
    const step=6+i*3;
    tctx.fillStyle="rgba(255,255,255,0.6)";
    for(let y=0;y<texH;y+=step){
      tctx.fillRect(0,y,texW,1);
    }
    tctx.fillStyle="rgba(0,0,0,0.5)";
    for(let x=0;x<texW;x+=step){
      tctx.fillRect(x,0,1,texH);
    }
    tctx.globalAlpha*=0.72;
  }
  tctx.restore();
}

// oil “dab”
function dab(x,y,r,ang,col,a){
  tctx.save();
  tctx.translate(x,y);
  tctx.rotate(ang);
  tctx.scale(1.25,0.85);
  const g=tctx.createRadialGradient(0,0,0,0,0,r);
  g.addColorStop(0,`rgba(${col[0]|0},${col[1]|0},${col[2]|0},${a})`);
  g.addColorStop(0.65,`rgba(${col[0]|0},${col[1]|0},${col[2]|0},${a*0.35})`);
  g.addColorStop(1,"rgba(0,0,0,0)");
  tctx.fillStyle=g;
  tctx.beginPath();
  tctx.ellipse(0,0,r,r*0.72,0,0,Math.PI*2);
  tctx.fill();
  tctx.restore();
}

// long brush stroke
function stroke(x,y,len,w,ang,col,a){
  tctx.save();
  tctx.translate(x,y);
  tctx.rotate(ang);
  tctx.lineCap="round"; tctx.lineJoin="round";
  tctx.globalAlpha=a;
  tctx.strokeStyle=`rgb(${col[0]|0},${col[1]|0},${col[2]|0})`;
  tctx.lineWidth=w;
  tctx.beginPath();
  const k=len*(0.28+0.22*Math.random());
  tctx.moveTo(-len*0.5,0);
  tctx.bezierCurveTo(-k,-w*0.4, k,w*0.4, len*0.5,0);
  tctx.stroke();
  tctx.restore();
}

function pickScene(){
  const rnd=makeRng(nextSeed());
  const pal=PALS[(rnd()*PALS.length)|0];
  const baseA=pal[0], baseB=pal[1], baseC=pal[2], deep=pal[3];

  // luxe feel: controlled contrast + warm highlight
  const warmth=0.10+0.12*rnd();
  const contrast=0.10+0.14*rnd();
  const brush=0.85+0.65*rnd();
  const impasto=0.18+0.24*rnd();
  const vign=0.10+0.14*rnd();
  const lightSpeed=0.08+0.10*rnd();
  const lightCount=3+(rnd()*2|0);
  const seed=nextSeed();

  const lights=[];
  for(let i=0;i<lightCount;i++){
    lights.push({
      u:rnd(), v:rnd(),
      su:0.18+0.18*rnd(),
      sv:0.18+0.18*rnd(),
      w:0.22+0.26*rnd(),
      p:rnd()*6.28,
      a:0.20+0.18*rnd()
    });
  }

  return {seed,pal:[baseA,baseB,baseC,deep],warmth,contrast,brush,impasto,vign,lightSpeed,lights};
}

function rebuild(){
  building=true;
  S.textContent="building…";
  scene=pickScene();

  const texScale = clamp(DPR,1, mobile?1.25:1.5); // keep sharp but safe on iOS
  texW=Math.max(360, (W*texScale)|0);
  texH=Math.max(520, (H*texScale)|0);
  [tex,tctx]=makeCanvas(texW,texH,false);

  // base gradient (quiet luxe)
  const [A,B,Cc,D]=scene.pal;
  const g=tctx.createLinearGradient(0,0,texW,texH);
  g.addColorStop(0, rgb(mix(A,[255,255,255],0.02)));
  g.addColorStop(0.45, rgb(mix(B,[255,255,255],0.02)));
  g.addColorStop(0.82, rgb(mix(Cc,D,0.08)));
  g.addColorStop(1, rgb(mix(D,[0,0,0],0.04)));
  tctx.fillStyle=g; tctx.fillRect(0,0,texW,texH);

  // soft “underpainting” clouds of color (non-repeating, natural)
  tctx.globalCompositeOperation="soft-light";
  const rnd=makeRng(scene.seed);
  for(let i=0;i<120;i++){
    const x=rnd()*texW, y=rnd()*texH;
    const r=(rnd()*0.26+0.08)*Math.min(texW,texH);
    const c = mix(mix(A,B,rnd()), mix(Cc,D,rnd()), rnd()*0.55);
    dab(x,y,r, rnd()*6.28, c, 0.22);
  }

  // brush strokes (directional, but layered -> oil feel)
  tctx.globalCompositeOperation="overlay";
  const N = Math.floor((texW*texH)/22000 * scene.brush);
  for(let i=0;i<N;i++){
    const x=rnd()*texW, y=rnd()*texH;
    const len=(rnd()*0.22+0.05)*Math.min(texW,texH);
    const w=(rnd()*2.8+0.6);
    const ang=(rnd()*1.2-0.6) + (y/texH-0.5)*0.35;
    const c = mix(mix(A,B,rnd()), mix(B,Cc,rnd()), rnd()*0.65);
    stroke(x,y,len,w,ang,c, 0.12+0.10*rnd());
  }

  // impasto highlights: tiny thick dabs + subtle emboss trick
  tctx.globalCompositeOperation="screen";
  for(let i=0;i<Math.floor(N*0.65*scene.impasto);i++){
    const x=rnd()*texW, y=rnd()*texH;
    const r=(rnd()*18+6);
    const c=mix([255,255,255], scene.pal[1], 0.35+0.25*rnd());
    dab(x,y,r,rnd()*6.28,c,0.20);
  }

  // canvas weave + gentle vignette (avoid “脏”，只塑形)
  tctx.globalCompositeOperation="source-over";
  drawWeave(1);

  const vg=tctx.createRadialGradient(texW*0.52,texH*0.50,Math.min(texW,texH)*0.22, texW*0.52,texH*0.50, Math.max(texW,texH)*0.75);
  vg.addColorStop(0,"rgba(0,0,0,0)");
  vg.addColorStop(1,`rgba(0,0,0,${scene.vign})`);
  tctx.fillStyle=vg; tctx.fillRect(0,0,texW,texH);

  buildGrain(scene.seed^0x9E3779B9);

  building=false;
  S.textContent="ready";
}

// debounce rebuild
function rebuildSoon(){
  clearTimeout(rebuildTimer);
  rebuildTimer=setTimeout(rebuild,120);
}

// ---------- animation ----------
let t=0,last=performance.now(),ema=60;
function drawLights(time){
  // dynamic lighting on top of static oil base
  ctx.save();
  ctx.globalCompositeOperation="soft-light";
  for(const L of scene.lights){
    const phase = time*scene.lightSpeed + L.p;
    const u = L.u + Math.sin(phase)*L.su;
    const v = L.v + Math.cos(phase*0.9)*L.sv;
    const cx = W*clamp(u,0,1);
    const cy = H*clamp(v,0,1);
    const r = Math.max(W,H)*(0.35+0.25*Math.sin(phase*0.7))*L.w;

    const g=ctx.createRadialGradient(cx,cy,0,cx,cy,r);
    g.addColorStop(0,`rgba(255,248,235,${0.16*L.a})`);
    g.addColorStop(0.35,`rgba(255,232,205,${0.10*L.a})`);
    g.addColorStop(1,"rgba(255,255,255,0)");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,W,H);
  }
  // sculpt shadows (adds depth -> “高级材质”)
  ctx.globalCompositeOperation="multiply";
  const s1=ctx.createLinearGradient(0,0,W,H);
  s1.addColorStop(0,`rgba(0,0,0,${0.10*scene.contrast})`);
  s1.addColorStop(0.5,"rgba(0,0,0,0)");
  s1.addColorStop(1,`rgba(0,0,0,${0.16*scene.contrast})`);
  ctx.fillStyle=s1; ctx.fillRect(0,0,W,H);

  ctx.restore();
}

function drawGrain(time){
  if(!grain) return;
  if(!grainPat){
    try{ grainPat=ctx.createPattern(grain,"repeat"); }
    catch(e){ grainPat=null; }
  }
  if(!grainPat) return;
  ctx.save();
  ctx.globalCompositeOperation="overlay";
  ctx.globalAlpha=0.045*(0.92+0.08*Math.sin(time*2.0));
  const ox=(Math.sin(time*0.9)*3)|0, oy=(Math.cos(time*1.1)*3)|0;
  ctx.translate(ox,oy);
  ctx.fillStyle=grainPat;
  ctx.fillRect(-10,-10,W+20,H+20);
  ctx.restore();
}

function frame(now){
  requestAnimationFrame(frame);
  const dt=now-last; last=now;
  const fps=1000/(dt||16.7); ema=ema*0.92+fps*0.08;
  t += dt*0.001;

  if(!tex || building) return;

  // subtle parallax (NOT a “moving texture”; just micro drift to avoid dead static)
  const dx = Math.sin(t*0.06)*8;
  const dy = Math.cos(t*0.05)*8;

  ctx.save();
  ctx.imageSmoothingEnabled=true;
  ctx.clearRect(0,0,W,H);

  // draw oil base
  ctx.drawImage(tex, dx, dy, W, H);

  // impasto “sheen” emboss trick: tiny offsets + soft-light
  ctx.globalCompositeOperation="soft-light";
  ctx.globalAlpha=0.22;
  ctx.drawImage(tex, dx+1.2, dy-1.0, W, H);
  ctx.globalAlpha=0.16;
  ctx.globalCompositeOperation="overlay";
  ctx.drawImage(tex, dx-1.0, dy+1.1, W, H);
  ctx.globalAlpha=1;
  ctx.globalCompositeOperation="source-over";

  // dynamic light
  drawLights(t);

  // grain (banding killer)
  drawGrain(t);

  ctx.restore();

  if(((now/500)|0)%2===0){
    S.textContent = `fps~${ema.toFixed(0)} · oil luxe · live light`;
  }
}

function switchNow(){
  rebuild();
  clearInterval(auto);
  auto=setInterval(switchNow,60*1000);
}

BTN.addEventListener("click",switchNow);

let auto=setInterval(switchNow,60*1000);
resize();
rebuild();
requestAnimationFrame(frame);

}catch(e){showErr(e);}
})();
</script>