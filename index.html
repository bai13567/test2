<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Warm Healing Ambient</title>
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#0b0605;font:12px ui-monospace,Menlo,Consolas,monospace}
canvas{position:fixed;inset:0;display:block}
#ui{position:fixed;left:12px;right:12px;top:12px;z-index:9;display:flex;gap:10px;align-items:center;pointer-events:none;padding-top:env(safe-area-inset-top)}
#pill{flex:1;min-width:0;padding:10px 12px;border-radius:14px;border:1px solid #ffd3a855;
background:linear-gradient(90deg,#ffbf6a22,#ffd6a822,#7ad7ff12);
backdrop-filter:blur(12px);box-shadow:0 0 0 1px #fff1 inset,0 16px 44px #000c;color:#ffe9d6;mix-blend-mode:screen;
text-shadow:0 0 18px #ffbf6a55,0 0 30px #ff7aa822;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#pill b{color:#fff}
#btn{pointer-events:auto;padding:10px 14px;border-radius:14px;border:1px solid #fff2;background:#0006;color:#fff;
backdrop-filter:blur(12px);box-shadow:0 0 0 1px #fff1 inset}
#btn:active{transform:translateY(1px)}
/* 极轻微扫线（可删），增强“真实屏幕质感”，但不会抢注意力 */
body:before{content:"";position:fixed;inset:-60px;pointer-events:none;background:
repeating-linear-gradient(0deg,rgba(255,255,255,.025),rgba(255,255,255,.025) 1px,transparent 2px,transparent 10px);
mix-blend-mode:overlay;opacity:.08;animation:scan 18s linear infinite}
@keyframes scan{to{transform:translateY(60px)}}
</style>

<canvas id="bg"></canvas>
<canvas id="grain"></canvas>

<div id="ui">
  <div id="pill"><b>WARM HEALING</b> · <span id="s">ambient</span></div>
  <button id="btn">切换</button>
</div>

<script>
(()=>{"use strict";
const bg=document.getElementById("bg"), g=document.getElementById("grain");
const B=bg.getContext("2d",{alpha:false}), G=g.getContext("2d",{alpha:true});
const S=document.getElementById("s"), BTN=document.getElementById("btn");
const clamp=(x,a,b)=>x<a?a:x>b?b:x, lerp=(a,b,t)=>a+(b-a)*t;

let W=0,H=0,DPR=1,seed=1,last=performance.now(),t=0;
let autoTimer=null;

// ===== 1) “温暖治愈”安全调色板（不会出紫/暗粉/大黑块）=====
// 每组： [top, mid, low, glow] 颜色都偏自然日光/奶油/蜜桃/蜂蜜/暖白
const PALETTES=[
  ["#FFF2E2","#FFD4A3","#E9A56B","#FFF6EE"], // 蜂蜜奶油
  ["#FFF5EA","#FFD9B8","#E7A07A","#FFF9F2"], // 日落奶茶但更干净
  ["#FFF3E6","#FFE0B8","#DFA47A","#FFF8F0"], // 暖白+蜜桃
  ["#FFF7ED","#FFD7A1","#E0A36C","#FFF9F3"], // 暖黄治愈
  ["#FFF4E9","#FFD6B0","#E6A07C","#FFF8F2"], // 柔软桃金
  ["#FFF6EE","#FFDFB9","#E3A16F","#FFF9F4"], // 奶油杏子
];
let palIndex=0;

// ===== 2) 颜色工具 =====
function hex2rgb(h){
  h=h.replace("#",""); const n=parseInt(h,16);
  return [(n>>16)&255,(n>>8)&255,n&255];
}
function rgb2hex(r,g,b){
  r=clamp(r|0,0,255);g=clamp(g|0,0,255);b=clamp(b|0,0,255);
  return "#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);
}
function mixHex(a,b,t){
  const A=hex2rgb(a),B=hex2rgb(b);
  return rgb2hex(lerp(A[0],B[0],t),lerp(A[1],B[1],t),lerp(A[2],B[2],t));
}

// ===== 3) 颗粒（不是噪点脏，是“极细腻抖动”去数码糊）=====
let noiseC=document.createElement("canvas"), noiseCtx=noiseC.getContext("2d",{alpha:true});
let noiseImg=null, noiseSize=256;

function rebuildNoise(){
  noiseC.width=noiseC.height=noiseSize;
  const img=noiseCtx.createImageData(noiseSize,noiseSize);
  const d=img.data;
  // 稍微偏“蓝噪”一点点：简单做法是用抖动阈值 + 分布收敛，避免团块
  let s=seed*1e6;
  function rnd(){ s=(s*1664525+1013904223)>>>0; return (s&0xffff)/0xffff; }
  for(let i=0;i<d.length;i+=4){
    const r=rnd();
    const v=(r<0.5? r*r : 1-(1-r)*(1-r)); // 让极端值更少（更细腻）
    const n=(v-0.5)*2; // -1..1
    // 只做亮度抖动，不引入彩噪，避免“脏紫/脏粉”
    const a=clamp(10 + (Math.abs(n)*22), 8, 36); // alpha 很低
    d[i]=255; d[i+1]=255; d[i+2]=255; d[i+3]=a;
  }
  noiseCtx.putImageData(img,0,0);
  noiseImg=noiseC;
}

// ===== 4) 自适应尺寸（iOS 友好：限制 DPR，避免发热/掉帧）=====
function resize(){
  DPR=clamp(devicePixelRatio||1,1,2); // 2 足够“精致”，再高收益小但耗电大
  W=innerWidth; H=innerHeight;
  bg.width=Math.floor(W*DPR); bg.height=Math.floor(H*DPR);
  bg.style.width=W+"px"; bg.style.height=H+"px";
  g.width=Math.floor(W*DPR); g.height=Math.floor(H*DPR);
  g.style.width=W+"px"; g.style.height=H+"px";
  B.setTransform(DPR,0,0,DPR,0,0);
  G.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener("resize",resize,{passive:true});

// ===== 5) 核心：时间呼吸（不做空间流动）=====
function draw(now){
  requestAnimationFrame(draw);
  const dt=now-last; last=now;
  t += dt*0.001;

  // 非常慢的“呼吸”和“色温漂移”，幅度很小
  const breathe = 0.5 + 0.5*Math.sin(t*0.18);
  const warmDrift= 0.5 + 0.5*Math.sin(t*0.07 + 1.7);

  const [top,mid,low,glow]=PALETTES[palIndex];

  // 轻微的色温/明度混合：用暖白 glow 稍微提亮，避免“脏灰”
  const top2 = mixHex(top, glow, 0.10 + 0.08*breathe);
  const mid2 = mixHex(mid, glow, 0.06 + 0.06*warmDrift);
  const low2 = mixHex(low, glow, 0.04 + 0.05*breathe);

  // 背景渐变：稳定的大形态（不动）
  B.clearRect(0,0,W,H);
  const sky=B.createLinearGradient(0,0,0,H);
  sky.addColorStop(0, top2);
  sky.addColorStop(0.55, mid2);
  sky.addColorStop(1, low2);
  B.fillStyle=sky;
  B.fillRect(0,0,W,H);

  // 柔光“光域”（很轻）：模拟真实环境里的散射光，不产生结构叙事
  const cx=W*0.35, cy=H*0.25;
  const r=Math.max(W,H)*0.85;
  const halo=B.createRadialGradient(cx,cy,0,cx,cy,r);
  halo.addColorStop(0, "rgba(255,255,255,"+(0.10+0.06*breathe)+")");
  halo.addColorStop(0.6,"rgba(255,245,235,"+(0.06+0.04*warmDrift)+")");
  halo.addColorStop(1, "rgba(255,255,255,0)");
  B.globalCompositeOperation="soft-light";
  B.fillStyle=halo;
  B.fillRect(0,0,W,H);

  // 暗角（极轻）：让画面更“自然聚光”，但不压黑
  const v=B.createRadialGradient(W*0.5,H*0.55,Math.min(W,H)*0.25,W*0.5,H*0.55,Math.max(W,H)*0.9);
  v.addColorStop(0,"rgba(0,0,0,0)");
  v.addColorStop(1,"rgba(0,0,0,"+(0.12-0.03*breathe)+")");
  B.globalCompositeOperation="multiply";
  B.fillStyle=v;
  B.fillRect(0,0,W,H);

  B.globalCompositeOperation="source-over";

  // 颗粒层：不动的噪声纹理 + 轻微时间闪烁（“时间噪声”），不会造成空间流动
  if(!noiseImg) rebuildNoise();
  G.clearRect(0,0,W,H);
  const alpha = 0.055 + 0.015*Math.sin(t*1.9); // 很轻
  G.globalAlpha=alpha;
  // 平铺
  const pat=G.createPattern(noiseImg,"repeat");
  G.fillStyle=pat;
  // 微小偏移（避免屏幕固定图案感，但不形成“流动”）
  const ox=(Math.sin(t*0.9)*3)|0, oy=(Math.cos(t*1.1)*3)|0;
  G.save();
  G.translate(ox,oy);
  G.fillRect(-10,-10,W+20,H+20);
  G.restore();
  G.globalAlpha=1;

  // 状态（不频繁刷新）
  if(((now/500)|0)%2===0){
    S.textContent=`ambient · palette ${palIndex+1}/${PALETTES.length} · dpr ${DPR.toFixed(1)}`;
  }
}

// ===== 6) 切换：只换“同样温暖治愈”的配色组 =====
function switchPalette(manual=true){
  palIndex=(palIndex+1)%PALETTES.length;
  // 换一张更“新鲜”的颗粒（种子变），但仍然很细腻
  seed = (seed*1664525 + 1013904223)>>>0;
  noiseImg=null;
  if(manual){
    if(autoTimer) clearInterval(autoTimer);
    autoTimer=setInterval(()=>switchPalette(false),60*1000);
  }
}
BTN.addEventListener("click",()=>switchPalette(true));

// 每分钟自动切换（你如果想固定一张，把这两行删掉即可）
autoTimer=setInterval(()=>switchPalette(false),60*1000);

// init
resize();
requestAnimationFrame(draw);
})();
</script>